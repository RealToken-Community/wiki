<!--
title: 4. Fonctionnement technique de la DAO REG
description: 
published: true
date: 2024-09-24T08:44:45.130Z
tags: 
editor: ckeditor
dateCreated: 2024-09-21T16:15:37.373Z
-->

<h2><strong>4.1. Smart Contracts principaux</strong></h2>
<h4><strong>Adresses des smart contracts :</strong></h4>
<ul>
  <li><a href="https://gnosisscan.io/address/0x4a5327347f077e72d2aab19f68ba8a7f12ec5d63#code">Governor: 0x4a5327347f077e72d2aab19f68ba8a7f12ec5d63</a></li>
  <li><a href="https://gnosisscan.io/address/0x3f2d192F64020dA31D44289d62DB82adE6ABee6c#code">REGTreasuryDAO: 0x3f2d192F64020dA31D44289d62DB82adE6ABee6c</a></li>
  <li><a href="https://gnosisscan.io/address/0x6382856a731Af535CA6aea8D364FCE67457da438#code">PowerVotingRegistry: 0x6382856a731Af535CA6aea8D364FCE67457da438</a></li>
  <li><a href="https://gnosisscan.io/address/0xe1877d33471e37fe0f62d20e60c469eff83fb4a0#code">Incentive: 0xe1877d33471e37fe0f62d20e60c469eff83fb4a0</a></li>
</ul>
<p>&nbsp;</p>
<h4><strong>⭐ Pour les novices</strong></h4>
<p>La DAO RealToken fonctionne grâce à des programmes informatiques spéciaux appelés "smart contracts". Ces contrats gèrent automatiquement les règles de la DAO, les votes, et les récompenses. Il y a quatre contrats principaux :</p>
<ol>
  <li>Le contrat de gouvernance : C'est le cerveau de la DAO. Il gère les propositions et les votes,</li>
  <li>Le contrat de trésorerie : Il gère les fonds de la DAO et applique un délai de sécurité avant d'exécuter les décisions,</li>
  <li>Le contrat de pouvoir de vote : Il calcule le pouvoir de vote de chaque membre,</li>
  <li>Le contrat d'incitation : Il distribue des récompenses aux membres actifs de la DAO qui effectuent des votes et bloquent leurs REG (si une période est activée par la DAO).<br>&nbsp;</li>
</ol>
<h4><strong>⭐⭐ Pour les initiés</strong></h4>
<p>La DAO RealToken repose sur un ensemble de smart contracts interconnectés :</p>
<ol>
  <li>Contrat de gouvernance : Basé sur le standard OpenZeppelin Governor, avec des modifications mineures, il gère le cycle de vie des propositions, le processus de vote, et l'exécution des décisions on-chain,</li>
  <li>Contrat de trésorerie (REGTreasuryDAO) : Implémente un mécanisme de timelock pour sécuriser l'exécution des décisions de la DAO et gérer ses fonds,</li>
  <li>Contrat de pouvoir de vote (PowerVotingRegistry) : Enregistre le pouvoir de vote des détenteurs de REG en fonction de leur solde, de boost et de leur activité, il permet ainsi une plus grande flexibilité que le modèle classique de vote par token, 1 token = 1 vote,</li>
  <li>Contrat d'incitation : Gère la distribution des récompenses pour encourager la participation active à la gouvernance, pour ce faire il faut voter et bloquer ses REG pour une durée déterminée (epoch).</li>
</ol>
<p>Ces contrats interagissent pour assurer un fonctionnement transparent et sécurisé de la DAO tout en encourageant la participation active à la gouvernance.<br>&nbsp;</p>
<h4><strong>⭐⭐⭐ Pour les experts</strong></h4>
<p>L'architecture technique de la DAO RealToken est composée de plusieurs smart contracts clés :</p>
<h5><strong>4.1.1. Contrat de gouvernance</strong></h5>
<ul>
  <li>Basé sur OpenZeppelin Governor avec des modifications personnalisées,</li>
  <li>Gère le cycle de vie complet des propositions : création, vote et exécution,</li>
  <li>Intègre les interactions avec le timelock pour augmenter la sécurité des exécutions,</li>
  <li>Implémente des contrôles d'accès pour la création de propositions, il permet l'activation de 4 mode différents pour autoriser les propositions à être créer,</li>
  <li>Interagit directement avec le PowerVotingRegistry pour créer les snapshots des pouvoirs de vote baser sur les valeurs enregistrées dans le PowerVotingRegistry.<br>&nbsp;</li>
</ul>
<h5><strong>4.1.2. Contrat de trésorerie (REGTreasuryDAO)</strong></h5>
<ul>
  <li>Basé sur le TimelockControllerUpgradeable d'OpenZeppelin,</li>
  <li>Implémente un mécanisme de timelock pour ajouter un délai de sécurité avant l'exécution des décisions on-chain,</li>
  <li>Gère les fonds de la DAO et contrôle leur utilisation,</li>
  <li>Intègre des rôles spécifiques (UPGRADER_ROLE) pour la gestion des mises à niveau du contrat,</li>
  <li>Utilise le pattern UUPS (Universal Upgradeable Proxy Standard) pour permettre des mises à niveau futures,</li>
  <li>Interagis avec les contrats externes appelés par les propositions.<br>&nbsp;</li>
</ul>
<h5><strong>4.1.3. Contrat de pouvoir de vote (PowerVotingRegistry)</strong></h5>
<ul>
  <li>Enregistre le pouvoir de vote en fonction du solde REG et d'autres facteurs (par exemple, durée de détention, lock, pool de liquidité, etc.),</li>
  <li>Implémente une logique d'auto-délégation pour simplifier l'activation du pouvoir de vote.</li>
</ul>
<p>&nbsp;</p>
<h5><strong>4.1.4. Contrat d'incitation</strong></h5>
<ul>
  <li>Intègre une logique d'état qui modifie les actions possibles, le cycle complet s'appelle “epoch”, pour chaque epoch il faut voter et bloquer ses REG pour recevoir des récompenses,</li>
  <li>Distribue des récompenses aux participants actifs de la gouvernance (qui vote),</li>
  <li>Utilise des mécanismes de verrouillage pour encourager l'engagement à long terme (verrouillage de la durée de l'epoch),</li>
  <li>Intègre des calculs de récompenses basés sur l'activité de gouvernance (votes et verrouillage des REG).</li>
</ul>
<p>Ces contrats sont conçus pour être modulaires et évolutifs, permettant des mises à jour et des améliorations futures sans perturber l'ensemble du système de gouvernance. Le contrat REGTreasuryDAO, en particulier, ajoute une couche de sécurité supplémentaire en imposant un délai entre la proposition d'une action et son exécution, permettant ainsi à la communauté de réagir si nécessaire.</p>
<p>A terme tous les contrats de l'écosystème RealToken seront contrôlés, upgradables uniquement par le contrat REGTreasuryDAO via des proposals, seules quelques fonctions d'urgence pourront être exécuté en dehors du cycle de la DAO par un comité de sécurité qui aura des droits limités à des actions d'urgence pour sécuriser les contrats.</p>
<p>&nbsp;</p>
<h2><strong>4.2. Mécanismes de vote et de proposition</strong></h2>
<h4><strong>⭐ Pour les novices</strong></h4>
<p>La DAO RealToken vous permet de participer aux décisions importantes de l'écosystème d'applications lié à la DAO. Voici comment ça marche :</p>
<ol>
  <li>Sur le forum de la DAO, les membres peuvent proposer des idées pour améliorer la DAO et l'écosystème,</li>
  <li>Un débat à lieu autour des propositions afin de mesurer la faisabilité et l'intérêt des propositions par la communauté,</li>
  <li>Si une proposition obtient un nombre de voix suffisamment, elle est transformée en proposal et soumise au vote de la DAO,</li>
  <li>Les membres de la DAO peuvent voter pour ou contre la proposition,</li>
  <li>Si la proposition est approuvée, elle est exécuté par le REGTreasuryDAO.</li>
</ol>
<p>&nbsp;</p>
<h4><strong>⭐⭐ Pour les initiés</strong></h4>
<p>Le système de vote et de proposition de la DAO RealToken comprend :</p>
<ol>
  <li>Le forum de la DAO : Où les membres peuvent proposer des idées et débattre afin de mesurer l'intérêt des propositions,</li>
  <li>Durant la période de débat, la communauté doit mesurer l'intérêt et la faisabilité des propositions,</li>
  <li>Si une proposition est jugée comme faisable et pertinente, une proposition concrète est travaillée avec l'établissement de tous les paramètres liés à la proposition, comme les actions à exécuter on-chain, le cout de développement, les gains pour la DAO, etc...</li>
  <li>Création de propositions : Processus contrôlé par des règles d'accès définies dans le contrat de gouvernance, selon les paramètres il peut y avoir des restrictions à la création de proposition, cela a pour but d'éviter les attaque de gouvernance, et permettre une mise en place progressive des règles de fonctionnement de la DAO en toutes sécurité,</li>
  <li>Cycle de vie des propositions : Création, période de vote, exécution (si approuvée).</li>
  <li>Mécanisme de timelock : Délai de sécurité avant l'exécution des décisions approuvées.</li>
</ol>
<p>&nbsp;</p>
<h4><strong>⭐⭐⭐ Pour les experts</strong></h4>
<p>Les mécanismes de vote et de proposition sont implémentés comme suit :</p>
<ol>
  <li>Forum de la DAO :<ul>
      <li>Où les utilisateurs peuvent proposer des idées et débattre afin de mesurer l’intérêt des propositions,</li>
      <li>Un débat a lieu autours des propositions afin de mesurer la faisabilité et l’intérêt des propositions par la communauté ou l'un des prestataires de la DAO,</li>
      <li>Si une proposition est jugée comme faisable et pertinente, une proposition concrète est travaillée avec l’établissement de tous les paramètres liés à la proposition, comme les actions a exécuter on-chain, le cout de développement, les gains pour la DAO, étude d'impacte et de risque, les besoins ou non d'un audite de sécurité, etc...</li>
    </ul>
  </li>
  <li>Création de propositions :<ul>
      <li>Contrôlées par le contrat de gouvernance,</li>
      <li>Quatre modes d'autorisation sont possibles pour la création de propositions, ces modes de proposition vise à optimiser la gestion des risques de la DAO, et à limiter l'exposition des fonds, avec un objectif de centralisation à moyen terme en fonction de la maturité de la DAO,</li>
      <li>inscription on-chain de la proposition avec tous les codes permettant l'exécution de la proposition si elle est approuvée,</li>
      <li>Interaction avec le PowerVotingRegistry pour créer des snapshots des pouvoirs de vote.</li>
    </ul>
  </li>
  <li>Processus de vote :<ul>
      <li>Basé sur le standard OpenZeppelin Governor avec des modifications personnalisées,</li>
      <li>Utilisation du pouvoir de vote enregistré dans le PowerVotingRegistry,</li>
      <li>Possibilité de vote : pour, contre ou abstention,</li>
      <li>Uniquement les membres enregistrés dans le PowerVotingRegistry peuvent voter,</li>
      <li>Le vote se fait sur une durée déterminée par le contrat de gouvernance, en général 7 jours,</li>
      <li>Les votants vérifient que la proposition est conforme à la description et aux échanges sur le forum de la DAO (vérification du code d'exécution on-chain).</li>
    </ul>
  </li>
  <li>Calcul du pouvoir de vote<ul>
      <li>Enregistré dans le PowerVotingRegistry,</li>
      <li>Prend en compte le solde REG, la durée de détention, le verrouillage, et potentiellement d'autres facteurs, selon l'algorithme de calcul validé par la DAO,</li>
      <li>Implémente une logique d'auto-délégation pour simplifier l'activation du pouvoir de vote.</li>
    </ul>
  </li>
  <li>Exécution des propositions :<ul>
      <li>Utilisation du REGTreasuryDAO comme timelock pour ajouter un délai de sécurité,</li>
      <li>Exécution on-chain des actions approuvées après le délai,</li>
      <li>Possibilité d'annulation pendant la période de timelock si nécessaire, par un groupe de sécurité.</li>
    </ul>
  </li>
  <li>Système d'incitation :<ul>
      <li>Géré par le contrat d'incitation,</li>
      <li>Récompenses basées sur la participation aux votes et le verrouillage de REG,</li>
      <li>Système d'epochs pour structurer les périodes de récompenses,</li>
      <li>Activé par la DAO qui définie la durée des epochs et les récompenses associés.</li>
    </ul>
  </li>
  <li>Mode de proposition :<ul>
      <li>ProposerWithRole : L’objectif est de limiter strictement les adresses pouvant soumettre un vote, afin de prévenir le spam et les propositions abusives. Ce mode sera activé uniquement pendant les premières semaines ou mois du déploiement initial de la gouvernance (version 1), pour établir une base solide avant d’élargir le nombre d’auteurs de propositions,</li>
      <li>ProposerWithVotingPower : Ce mode exige que l’auteur de proposition ait un pouvoir de vote minimum. Sans ce pouvoir, aucune proposition ne peut être créée. C’est l’étape ultime de la décentralisation, où tous ceux ayant suffisamment de pouvoir de vote peuvent soumettre des propositions. Il n’y a plus de rôles privilégiés; tous les détenteurs suivent les mêmes règles,</li>
      <li>ProposerWithRoleAndVotingPower : Ce mode combine deux restrictions, l’auteur de proposition doit avoir un rôle spécifique et un pouvoir de vote minimum. Si l’une des conditions n’est pas remplie, la proposition échouera. Ce mode élargit les propositions aux membres les plus engagés de la communauté, exigeant un solde minimum de REG pour garantir leur engagement et des enjeux financiers. Ils doivent être élus et posséder suffisamment de REG. Cela permet de démarrer la décentralisation, tester les processus et limiter les risques,</li>
      <li>ProposerWithRoleOrVotingPower : Ce mode permet la création de propositions si l’auteur de proposition possède soit le rôle requis, soit un pouvoir de vote minimum. Si aucune de ces conditions n’est remplie, la proposition échouera. C’est l’avant-dernière étape de la décentralisation de la gouvernance. Ce mode exige un nombre important de REG pour proposer librement des améliorations, sans passer par un rôle spécifique. Cela permet à quiconque de proposer des améliorations en engageant un nombre significatif de REG, tout en maintenant les auteurs de proposition ayant un rôle spécifique, qui n’ont pas besoin de REG minimum. Le rôle peut être retiré en cas de non-respect des processus.</li>
    </ul>
  </li>
  <li>Délégation :<ul>
      <li>Délégation de pouvoir de vote a été retirée pour permettre l'activation des incitations pour les votants et les lockers de REG,</li>
      <li>Les utilisateurs ne peuvent pas déléguer leur pouvoir de vote à d'autres adresses, mais bénéficient d'une auto-délégation par défaut,</li>
      <li>Dans une v2 la délégation fera sont retour et sera même une partie importante du système.</li>
    </ul>
  </li>
</ol>
<p>&nbsp;</p>
<p>Ces mécanismes sont conçus pour assurer une gouvernance équitable, sécurisée et incitative, tout en permettant une évolution future du système.</p>
<p>Dans les premières semaines/mois la DAO est implémentée avec des restrictions afin de permettre la mise en place des règles de fonctionnement, d’expérimenter les processus et de limiter les risques.</p>
<p>Afin de donner une bonne vision des étapes d'évolution, un débat devra avoir lieu pour déterminer les paliers déclenchant une décentralisation de niveau supérieur, donnant une plus grande autonomie et ce libérant de la confiance apporté aux divers intervenants.</p>
<p><br>&nbsp;</p>
<h2><strong>4.3. Système d'incitation et de récompense</strong></h2>
<h4><strong>⭐ Pour les novices</strong></h4>
<p>La DAO RealToken vous récompense pour votre participation active. Voici comment ça marche :</p>
<ol>
  <li>Vous gagnez des récompenses sous diverses formes en votant sur les propositions,</li>
  <li>Vous pouvez augmenter vos récompenses en bloquant vos tokens REG pendant une certaine période,</li>
  <li>La participation dans certaines pools de liquidité ou autre de l'écosystème RealToken peuvent vous donner des récompenses supplémentaires,</li>
  <li>Les récompenses peuvent être sous forme de REG, d'ERC20, ou encore sous forme de boost sur le pouvoir de vote,</li>
  <li>La DAO décide des récompenses et des paramètres du système d'incitation.</li>
</ol>
<p>&nbsp;</p>
<h4><strong>⭐⭐ Pour les initiés</strong></h4>
<p>Le système d'incitation de la DAO RealToken est conçu pour encourager la participation active :</p>
<ol>
  <li>La DAO définie les récompenses et les paramètres du système d'incitation, le type et les montants des récompenses,</li>
  <li>Récompenses basées sur la participation aux votes et le verrouillage de REG, participation dans certaines pools de liquidité ou autre de l'écosystème RealToken peuvent vous donner des récompenses supplémentaires,</li>
  <li>Système d'epochs pour structurer les périodes de récompenses et optimiser la participation,</li>
  <li>Attribution on-chain automatique des récompenses en stable coin claimable à la fin de chaque epoch,</li>
  <li>Possibilité pour la DAO d'ajuster les paramètres du système d'incitation afin d'optimiser la participation et répondre à l'évolution de la DAO.</li>
</ol>
<p>&nbsp;</p>
<h4><strong>⭐⭐⭐ Pour les experts</strong></h4>
<p>Le système d'incitation et de récompense est implémenté comme suit :&nbsp;</p>
<ol>
  <li>Contrat d'incitation :<ul>
      <li>Gère l'état du système (actif/inactif) et les cycles d'epochs,</li>
      <li>Calcule les récompenses en fonction de l'activité de vote et du verrouillage de REG,</li>
      <li>Distribue automatiquement les récompenses à la fin de chaque epoch.</li>
    </ul>
  </li>
  <li>Mécanisme de verrouillage :<ul>
      <li>Les utilisateurs peuvent verrouiller leurs REG pour la durée d'un epoch dans le contrat d'incitation,</li>
      <li>Le verrouillage peut augmenter le pouvoir de vote et les récompenses potentielles selon les paramètres définis par la DAO,</li>
      <li>Le verrouillage permet de marquer un engagement à long terme de la part du votant, diminue la liquidité des REG et limite les risques d'attaque de gouvernance.</li>
    </ul>
  </li>
  <li>Paramètres ajustables :<ul>
      <li>Durée des epochs,</li>
      <li>Quantité de récompenses par epoch,</li>
      <li>Type de récompenses,</li>
      <li>Ces paramètres sont appliqués par la DAO dans la proposal d'activation d'une epoch,</li>
      <li>Pour les boost de pouvoir de vote, la DAO peut les ajuster en fonction des besoins la formule et le poids accordé dans le système de calcul du powerVoting qui génère les pouvoir de vote.</li>
    </ul>
  </li>
  <li>Intégration avec le PowerVotingRegistry :<ul>
      <li>Le verrouillage des REG affecte le pouvoir de vote enregistré,</li>
      <li>Synergie entre la participation à la gouvernance et les récompenses.<br>&nbsp;</li>
    </ul>
  </li>
  <li>Sécurité et évolutivité :<ul>
      <li>Contrat upgradable pour permettre des améliorations futures,</li>
      <li>Mécanismes de pause en cas d'urgence.</li>
    </ul>
  </li>
  <li>Calcul des récompenses :<ul>
      <li>Comptabilise le nombre total de propositions émises durant une epoch,</li>
      <li>Comptabilise le nombre de votes effectués par chaque votant durant l'epoch,</li>
      <li>Pondéré par la quantité de REG verrouillés.</li>
    </ul>
  </li>
</ol>
<p>&nbsp;</p>
<pre><code class="language-plaintext">userBonus = (userState.depositAmount * userState.voteAmount * epochState.totalBonus) / epochState.totalWeights;</code></pre>
<p>&nbsp;</p>
<ul>
  <li><mark class="marker-blue">`userState.depositAmount`</mark> : Le montant déposé par l'utilisateur pour cette époque en REG,</li>
  <li><mark class="marker-blue">`userState.voteAmount`</mark> : Le nombre de votes effectués par l'utilisateur durant cette époque,</li>
  <li><mark class="marker-blue">`epochState.totalBonus`</mark> : Le montant total de bonus alloués pour cette époque,</li>
  <li><mark class="marker-blue">`epochState.totalWeights`</mark> : La somme totale des votes pour tous les utilisateurs dans cette époque.</li>
</ul>
<p>Cette formule est appliquée dans le contrat aux lignes suivantes :</p>
<p><a href="https://gnosisscan.io/address/0x4b79755d1ea8937c027408e3aa72d69a260f6237#code#F18#L1">REGIncentiveVault.sol</a></p>
<p>startLine: 342</p>
<p>endLine: 346</p>
<p><br>Ce système vise à créer un cercle vertueux d'engagement dans la gouvernance, en récompensant la participation active tout en renforçant la stabilité à long terme de l'écosystème RealToken.</p>
<p>La mécanique de récompense sera entièrement revus avec la mise ne service de la gouvernance V2 utilisant les NFT afin d'améliorer le système d'incitation, permettre une plus grande granularité, et précision des actions à encourager en fonction des besoins de la DAO et des profiles des holders.</p>
<p>De nouveaux types de récompenses seront introduit comme comme la matière noire des NFT Cityzen, des points de soutiens pour les votes permettant la mise en avant des contenus liés au NFT Activity, etc...</p>
<p>L'écosystème RealToken est pensé pour disposer de nombreux outils d'optimisation de participation aux votes, et encourager les actions et contributions divers qui sont bénéfiques à la DAO tout en permettant un contrôle précis des finances de la DAO afin de ne pas dilapider la treasury ou dévaluer le token REG.<br>&nbsp;</p>
<p style="text-align:right;"><a href="/fr/DAO/Guide_Pratique">Page suivante</a></p>
